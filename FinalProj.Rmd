---
title: "Beak"
author: "Karim Dahr, Brendan Fox, Tingwei Hu, Joseph Milosh"
date: "2022-12-09"
output: html_document
bibiography: Beakering.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(tidyverse)
library(knitr)
library(Momocs)
library(scatterplot3d)
library(viridis)
library(RColorBrewer)
library(reshape2)
```
# Introduction




# Methods
## Data Collection
Morphological and ecological data analyzed in this report were gathered from the AVONET data set described by @tobias2022avonet. Within the data set, geographical and phylogenetic information were organized and the results shared by @pigot2020macroevolutionary. 
## Data Analysis
```{r, data prep, message=FALSE}
data.ori <- read_csv("AVONETdata_BirdTree_Pigot2020.csv")

#removed any rows where Trophic.Level or Trophic.Niche has N/A value
data.tmp <- data.ori[!is.na(data.ori$Trophic.Level),]
data <- data.tmp[!is.na(data.tmp$Trophic.Niche),]

```

```{r, normalized ratios & log transform relevant columns}
data.norm <- data %>% 
  mutate(l.w.ratio = Beak.Width/Beak.Length_Culmen) %>% 
  mutate(bsize.bodymass.ratio = l.w.ratio / Mass) %>% #beak lw ratio/body mass
  mutate(l.log = log10(data$Beak.Length_Culmen)) %>% 
  mutate(w.log = log10(data$Beak.Width)) %>% 
  mutate(mass.log = log10(data$Mass)) #body mass
```

# Results


```{r, fig.cap= "Figure on Habitats____"}
data.norm <- data %>% 
  mutate(l.w.ratio = Beak.Length_Culmen / Beak.Width)
data.norm$l.w.ratio

ggplot(data.norm, mapping = aes(x = l.w.ratio, y = Trophic.Niche, color = Trophic.Level)) +
  geom_point() +
  facet_wrap(~Habitat)
```

```{r, fig.cap="Figure 1: Relationship of Beak Width to Beak Length Separated by Trophic Level"}
ggplot(data, aes(x = Beak.Width, y = Beak.Length_Culmen, color = Trophic.Level)) +
  geom_smooth(method="lm")+
  scale_y_continuous(trans='log10')+
  scale_x_continuous(trans='log10')
```

```{r, fig.cap="Figure 2: "}
ggplot(data.norm, aes(x = Trophic.Niche, y = l.w.ratio, color = Trophic.Niche)) +
  geom_boxplot() + theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  coord_cartesian(ylim = c(quantile(data.norm$l.w.ratio, 0.0), quantile(data.norm$l.w.ratio, 0.999)))
```



### Analysis of mass vs. beak volume
```{r, include=FALSE}
data.norm <- data.norm %>% 
  mutate(beak.volume = ((Beak.Length_Culmen*Beak.Depth*Beak.Width)/3)) 
data.norm$beak.volume
```

```{r, fig.cap="Figure 5: "}
ggplot(data.norm, aes(x = Mass, y = beak.volume, color = Trophic.Level, type="n")) +
  geom_smooth(method="lm")+
  scale_y_continuous(trans='log10')+
  scale_x_continuous(trans='log10') 
```

At this point we can see that a birds mass does correlate positively with beak size (which we are approximating with beak volume) across all trophic levels. Here we assumed that a birds beak shape was roughly pyramidal as most beaks tend to fit that description (shape used does not matter much, just need measure to capture variation in all beak size parameters). Using this we were able to approximate beak size by using the volume formula for a pyramid to approximate the maximum volume that could be held by the beak ($$Volume = (width)(length)(height)/3$$). This is essentially a positive control as one can expect heavier bird to be larger, and subsequently have a larger beak. Nevertheless, this proves useful in our analysis in helping to show what factors have an impact on beak shape and size and shows that it is potentially possible to predict beak size or shape using other explanatory variables.

Analysis of Width to Length Ratio to Bird Size
```{r, fig.cap= "Figure 4: "}
ggplot(data.norm, aes(x = l.w.ratio, y = Mass, color = Trophic.Level, type="n")) +
  geom_smooth(method="lm")+
  scale_y_continuous(trans='log10')+
  scale_x_continuous(trans='log10') 
```
Can see here that the shape of a beak does not appear to have a strong positive or negative correlation with respect to bird mass across species. This likely means that bird mass does not have a large impact on beak shape.


Final Regression Models
```{r}
#1
carnivore.data.norm <- subset(data.norm, Trophic.Level == "Carnivore")
first.model <- lm(carnivore.data.norm$l.w.ratio ~ carnivore.data.norm$Mass + 
                    carnivore.data.norm$Centroid.Latitude + carnivore.data.norm$Centroid.Longitude)

summary(first.model)

plot(first.model)

#2
herbivore.data.norm <- subset(data.norm, Trophic.Level == "Herbivore")
second.model <- lm(herbivore.data.norm$l.w.ratio ~ herbivore.data.norm$Mass + 
                     herbivore.data.norm$Centroid.Latitude + herbivore.data.norm$Centroid.Longitude)

summary(second.model)

plot(second.model)

#3
scavenger.data.norm <- subset(data.norm, Trophic.Level == "Scavenger")
third.model <- lm(scavenger.data.norm$l.w.ratio ~ scavenger.data.norm$Mass + 
                    scavenger.data.norm$Centroid.Latitude + scavenger.data.norm$Centroid.Longitude)

summary(third.model)

plot(third.model)

#4
omnivore.data.norm <- subset(data.norm, Trophic.Level == "Omnivore")
fourth.model <- lm(omnivore.data.norm$l.w.ratio ~ omnivore.data.norm$Mass +
                     omnivore.data.norm$Centroid.Latitude +  omnivore.data.norm$Centroid.Longitude)

summary(fourth.model)

plot(fourth.model)

```





# Discussion


# Author Contributions
Karim Dahr: 
Brendan Fox:
Tingwei Hu:
Joseph Milosh: 

# References